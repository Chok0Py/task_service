# ะกะตัะฒะธั ัะฟัะฐะฒะปะตะฝะธั ะทะฐะดะฐัะฐะผะธ (Task Service)

ะัะพะตะบั ะฟัะตะดััะฐะฒะปัะตั ัะพะฑะพะน **REST API ัะตัะฒะธั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะทะฐะดะฐัะฐะผะธ** ั ะฟะพะดะดะตัะถะบะพะน ะฐัะธะฝััะพะฝะฝะพะน ะพะฑัะฐะฑะพัะบะธ ัะตัะตะท Celery ะธ ะธะฝัะตะณัะฐัะธะตะน ั RabbitMQ.

---

## ๐ ะกะพะดะตัะถะฐะฝะธะต

- [ะะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ](#-ะพะฟะธัะฐะฝะธะต-ะฟัะพะตะบัะฐ)
- [ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ](#-ัะตัะฝะพะปะพะณะธัะตัะบะธะน-ััะตะบ)
- [ะััะธัะตะบัััะฐ](#-ะฐััะธัะตะบัััะฐ)
- [ะัััััะน ััะฐัั](#-ะฑัััััะน-ััะฐัั)
- [ะกัััะบัััะฐ ะฟัะพะตะบัะฐ](#-ััััะบัััะฐ-ะฟัะพะตะบัะฐ)
- [ะะพะบัะผะตะฝัะฐัะธั](#-ะดะพะบัะผะตะฝัะฐัะธั)
- [ะัะฝะพะฒะฝัะต ะบะพะผะฐะฝะดั](#-ะพัะฝะพะฒะฝัะต-ะบะพะผะฐะฝะดั)
- [ะะตะทะพะฟะฐัะฝะพััั](#-ะฑะตะทะพะฟะฐัะฝะพััั)
- [ะะพะดะดะตัะถะบะฐ](#-ะฟะพะดะดะตัะถะบะฐ)

---

## ๐ฏ ะะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ

ะัะพะตะบั ะฟัะตะดััะฐะฒะปัะตั ัะพะฑะพะน REST API ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะทะฐะดะฐัะฐะผะธ ั ัะฐะทะปะธัะฝัะผะธ ะฟัะธะพัะธัะตัะฐะผะธ ะธ ััะฐัััะฐะผะธ.  

ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ:

- **ะฃะฟัะฐะฒะปะตะฝะธะต ะทะฐะดะฐัะฐะผะธ**
  - ะกะพะทะดะฐะฝะธะต ะทะฐะดะฐั
  - ะัะพัะผะพัั ัะฟะธัะบะฐ ะทะฐะดะฐั
  - ะะพะปััะตะฝะธะต ะธะฝัะพัะผะฐัะธะธ ะพ ะบะพะฝะบัะตัะฝะพะน ะทะฐะดะฐัะต
  - ะัะผะตะฝะฐ ะธะปะธ ะธะทะผะตะฝะตะฝะธะต ััะฐัััะฐ ะทะฐะดะฐัะธ
- **ะัะธะฝััะพะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ**
  - Celery worker ะดะปั ัะพะฝะพะฒะพะน ะพะฑัะฐะฑะพัะบะธ
  - RabbitMQ ะบะฐะบ ะฑัะพะบะตั ัะพะพะฑัะตะฝะธะน
  - ะคะพะฝะพะฒะฐั ะพะฑัะฐะฑะพัะบะฐ ัะตะทัะปััะฐัะพะฒ ะทะฐะดะฐั (ะฝะฐะฟัะธะผะตั, ัะฒะตะดะพะผะปะตะฝะธั)
- **ะกัะตะผั Pydantic**
  - ะะฐะปะธะดะฐัะธั ะดะฐะฝะฝัั ัะตัะตะท Pydantic v2
  - ะัะฟะพะปัะทะพะฒะฐะฝะธะต `model_config = ConfigDict(from_attributes=True)`

---

## ๐ ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

- **Backend**
  - FastAPI 0.115
  - SQLAlchemy 2.0 (async + sync)
  - PostgreSQL 16
  - Alembic ะดะปั ะผะธะณัะฐัะธะน
  - Celery 5.4 ั RabbitMQ (asynchronous tasks)
- **ะะฝััะฐััััะบัััะฐ**
  - Docker & Docker Compose
  - Python 3.11
- **ะขะตััะธัะพะฒะฐะฝะธะต**
  - Pytest

---

## ๐ ะััะธัะตะบัััะฐ

ะะธะบัะพัะตัะฒะธัะฝะฐั ััััะบัััะฐ ะฟัะพะตะบัะฐ ะฒะฝัััะธ Docker Compose:

โโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโ
โ PostgreSQL โ โ RabbitMQ โ โ Backend โ
โ (port 5432) โ โ (port 5672) โ โ FastAPI 8000 โ
โโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโ
      โ                 |
      โโโโโโ Celery โโโโโ

ะะพัะพะบ ะดะฐะฝะฝัั ะฟัะธ ัะพะทะดะฐะฝะธะธ ะทะฐะดะฐัะธ:

1. ะะปะธะตะฝั โ Backend API (`POST /api/tasks/`)
2. Backend โ ะะฐะทะฐ ะดะฐะฝะฝัั PostgreSQL (ัะพััะฐะฝะตะฝะธะต ะทะฐะดะฐัะธ)
3. Backend โ Celery task (ัะพะฝะพะฒะฐั ะพะฑัะฐะฑะพัะบะฐ)
4. Celery Worker โ ะฒัะฟะพะปะฝะตะฝะธะต ะทะฐะดะฐัะธ
5. Backend โ ะบะปะธะตะฝั (ะพัะฒะตั API)
6. Celery Worker โ ะฟัะธ ะฝะตะพะฑัะพะดะธะผะพััะธ ะพัะฟัะฐะฒะบะฐ ัะตะทัะปััะฐัะพะฒ/ัะฒะตะดะพะผะปะตะฝะธะน

---

## ๐ ะัััััะน ััะฐัั

### ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั

- Docker ะธ Docker Compose
- Python 3.11 (ะปะพะบะฐะปัะฝะพ, ะตัะปะธ ะฝัะถะฝะพ)

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั

```bash
git clone <repository-url>
cd task_service
2. ะกะพะทะดะฐะฝะธะต .env ัะฐะนะปะฐ
ะัะธะผะตั .env:

env
ะะพะฟะธัะพะฒะฐัั ะบะพะด
POSTGRES_DB=taskdb
POSTGRES_USER=user
POSTGRES_PASSWORD=pass
POSTGRES_HOST=db
POSTGRES_PORT=5432

DATABASE_URL=postgresql+asyncpg://user:pass@db:5432/taskdb

CELERY_BROKER_URL=amqp://guest:guest@rabbitmq:5672//
CELERY_RESULT_BACKEND=rpc://
3. ะะฐะฟััะบ ะฟัะพะตะบัะฐ
ะก Docker Compose:

bash
ะะพะฟะธัะพะฒะฐัั ะบะพะด
docker compose build
docker compose up -d
ะัะธะผะตะฝะตะฝะธะต ะผะธะณัะฐัะธะน:

bash
ะะพะฟะธัะพะฒะฐัั ะบะพะด
docker compose exec web alembic upgrade head
ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั ัะตัะฒะธัะพะฒ:

bash
ะะพะฟะธัะพะฒะฐัั ะบะพะด
docker compose ps
ะะพัััะฟ ะบ API:

FastAPI: http://localhost:8000

Celery Flower: http://localhost:5555

๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ
bash
ะะพะฟะธัะพะฒะฐัั ะบะพะด
task_service/
โโโ app/
โ   โโโ api/v1/        # ะญะฝะดะฟะพะธะฝัั API
โ   โโโ core/          # ะะฐัััะพะนะบะธ ะฟัะพะตะบัะฐ ะธ celery_app
โ   โโโ models/        # SQLAlchemy ะผะพะดะตะปะธ
โ   โโโ schemas/       # Pydantic ััะตะผั
โ   โโโ tasks.py       # Celery ะทะฐะดะฐัะธ
โ   โโโ database.py    # SQLAlchemy session/engine
โโโ alembic/           # ะะธะณัะฐัะธะธ ะฑะฐะทั ะดะฐะฝะฝัั
โโโ Dockerfile
โโโ docker-compose.yml
โโโ requirements.txt
โโโ .env
๐งช ะัะฝะพะฒะฝัะต ะบะพะผะฐะฝะดั
Docker Compose
bash
ะะพะฟะธัะพะฒะฐัั ะบะพะด
docker compose up -d       # ะะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ
docker compose down        # ะััะฐะฝะพะฒะบะฐ ัะตัะฒะธัะพะฒ
docker compose logs -f web # ะัะพัะผะพัั ะปะพะณะพะฒ backend
docker compose logs -f worker # ะัะพัะผะพัั ะปะพะณะพะฒ Celery
Alembic
bash
ะะพะฟะธัะพะฒะฐัั ะบะพะด
docker compose exec web alembic revision --autogenerate -m "ะพะฟะธัะฐะฝะธะต"
docker compose exec web alembic upgrade head
docker compose exec web alembic downgrade -1